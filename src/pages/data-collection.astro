---
// Data Collection Page
---

<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>GearScout</title>
</head>
<body>
	<div class="header">
		<div class="logo">
			<img src="/logo.png" alt="2338 logo" height="100" width="100" loading="eager" fetchpriority="high"/>
		</div>
		<div class="analytics">
			<a href="https://data.gearitforward.com/" class="analytics-button">ANALYTICS</a>
		</div>
	</div>

	<main class="page data-collection-page">
		<form class="data-collection-form" id="data-collection-form">
			<div class="content-wrapper">

				<div class="form-field">
					<input 
						id="match-number" 
						name="matchNumber" 
						type="number" 
						min="0" 
						max="999"
						autocomplete="off"
					/>
					<label for="match-number">Match Number</label>
				</div>

				<div class="form-field">
					<input 
						id="team-number" 
						name="teamNumber" 
						type="number"
						autocomplete="off"
					/>
					<label for="team-number">Team Number</label>
				</div>

				<div class="alliance-section">
					<div class="toggle-button-group">
						<button type="button" class="alliance-toggle red" data-value="red">
							RED ALLIANCE
						</button>
						<button type="button" class="alliance-toggle blue" data-value="blue">
							BLUE ALLIANCE
						</button>
					</div>
				</div>

				<h2 class="section-title">Auto</h2>

				<h2 class="section-title">Teleop</h2>

				<div class="action-area">
					<button type="button" class="back-button" onclick="window.location.href='/'">
						Back
					</button>
					<button type="submit" class="submit-button">
						Submit
					</button>
				</div>
			</div>
		</form>
	</main>
</body>
</html>

<style lang="scss">
@use '../styles/data-collection.scss';
</style>

<script>
	// Floating label functionality for form fields
	const formFields = document.querySelectorAll('.form-field');
	
	formFields.forEach(field => {
		const input = field.querySelector('input');
		if (!input) return;

		// Check if input has value on load
		if (input.value) {
			field.classList.add('has-value');
		}

		// Update has-value class on input
		input.addEventListener('input', () => {
			if (input.value) {
				field.classList.add('has-value');
			} else {
				field.classList.remove('has-value');
			}
		});

		// Handle focus/blur for proper label animation
		input.addEventListener('blur', () => {
			if (!input.value) {
				field.classList.remove('has-value');
			}
		});
	});

	// Alliance color toggle functionality
	const allianceButtons = document.querySelectorAll('.alliance-toggle');
	const submitButton = document.querySelector('.submit-button') as HTMLButtonElement;
	const matchNumberInput = document.getElementById('match-number') as HTMLInputElement;
	const teamNumberInput = document.getElementById('team-number') as HTMLInputElement;
	let selectedAlliance = '';

	// Function to validate form and update submit button state
	function validateForm() {
		const hasMatchNumber = matchNumberInput && matchNumberInput.value.trim() !== '';
		const hasTeamNumber = teamNumberInput && teamNumberInput.value.trim() !== '';
		const hasAlliance = selectedAlliance !== '';
		
		const isValid = hasMatchNumber && hasTeamNumber && hasAlliance;
		
		if (submitButton) {
			submitButton.disabled = !isValid;
		}
	}

	// Initialize submit button as disabled
	if (submitButton) {
		submitButton.disabled = true;
	}

	// Add input listeners to validate on change
	if (matchNumberInput) {
		matchNumberInput.addEventListener('input', validateForm);
	}
	if (teamNumberInput) {
		teamNumberInput.addEventListener('input', validateForm);
	}

	allianceButtons.forEach(button => {
		button.addEventListener('click', () => {
			// Remove selected class from all buttons
			allianceButtons.forEach(btn => btn.classList.remove('selected'));
			
			// Add selected class to clicked button
			button.classList.add('selected');
			selectedAlliance = button.getAttribute('data-value') || '';
			
			// Validate form after alliance selection
			validateForm();
		});
	});

	// Add form submit handler to prevent page reload
	const form = document.getElementById('data-collection-form') as HTMLFormElement;
	if (form) {
		form.addEventListener('submit', (event) => {
			event.preventDefault();
			
			// TODO: Handle form submission (e.g., save data, submit to API)
			console.log('Form submitted with data:', {
				matchNumber: matchNumberInput?.value,
				teamNumber: teamNumberInput?.value,
				alliance: selectedAlliance
			});
		});
	}
</script>